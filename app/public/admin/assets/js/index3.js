var g=(e,t,o)=>new Promise((c,m)=>{var i=l=>{try{p(o.next(l))}catch(d){m(d)}},f=l=>{try{p(o.throw(l))}catch(d){m(d)}},p=l=>l.done?c(l.value):Promise.resolve(l.value).then(i,f);p((o=o.apply(e,t)).next())});import{Y as x,P as B,v as T,M as q}from"./@element-plus.js";import{s as E,d as y}from"./article.js";import{a as $}from"./category.js";import{_ as j,a as w,t as P}from"./index.js";import{a5 as s,aj as U,o as C,c as N,Y as a,R as n,S as z,Q as F,F as L,a as k,W as h,X as R}from"./@vue.js";import"./api.js";import"./axios.js";import"./element-plus.js";import"./lodash-es.js";import"./@vueuse.js";import"./@popperjs.js";import"./@ctrl.js";import"./dayjs.js";import"./async-validator.js";import"./memoize-one.js";import"./escape-html.js";import"./normalize-wheel-es.js";import"./@floating-ui.js";import"./pinia.js";import"./vue-router.js";import"./js-cookie.js";const Y={name:"article-index",setup(){return{Edit:x,Delete:B,View:T,Search:q}},data:()=>({keywords:"",cid:0,cur:1,categorySelected:[-1],category:[],tableData:[],multipleSelection:[],count:0,loading:!0}),computed:{},created(){let{cur:e=1,cid:t=0,keywords:o=""}=this.$route.query;this.cur=+e,this.categorySelected=+t,this.keywords=o,this.queryCategory(),this.search()},watch:{$route(e,t){if(console.log(e),e.name=="article-index"){let{cur:o,cid:c,keywords:m}=e.query;this.cur=+o,this.cid=+c,this.keywords=m,this.search()}}},methods:{clearSearch(){this.$router.replace({name:"article-index",query:{cur:1,cid:0,keywords:""}})},doSearch(){this.$router.replace({name:"article-index",query:{cur:this.cur,cid:this.cid,keywords:this.keywords}}),this.search()},search(){return g(this,null,function*(){try{let e=yield E(this.cur,this.keywords,this.cid);e.code===200&&(this.tableData=[...e.data.list],this.count=e.data.count,this.loading=!1)}catch(e){console.log(e)}})},handleCurrentChange(e){this.loading=!0,this.cur=+e,this.doSearch()},toggleSelection(e){e?e.forEach(t=>{this.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e},queryCategory(){return g(this,null,function*(){try{let e=yield $();if(e.code===200){let t=w(P(e.data)),o=w(e.data);this.cateList=o,this.category=[...t]}}catch(e){console.log(e)}})},handleChange(e){this.cid=e[e.length-1]},toEdit(e){let t=e.id;this.$router.push({name:"article-edit",params:{id:t}})},delSome(){let e=this.multipleSelection.map(t=>t.id);console.log("----->",e.join(",")),this.$confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>g(this,null,function*(){(yield y(e.join(","))).code===200&&(this.$message({message:"\u6587\u7AE0\u5220\u9664\u6210\u529F ^_^",type:"success"}),this.search())})).catch(()=>{this.$message({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})},handleDel(e){return g(this,null,function*(){let t=e.id;try{(yield y(t)).code===200&&(this.$message({message:"\u6587\u7AE0\u5220\u9664\u6210\u529F ^_^",type:"success"}),this.search())}catch(o){console.log(o)}})}},onBeforeUnmount(){}},A={class:"mr-10"},M=h(" \u680F\u76EE\u7B5B\u9009 "),Q=h("\u641C\u7D22"),W=h("\u65B0\u589E"),X={style:{"margin-top":"20px"}},G=h(" \u6279\u91CF\u64CD\u4F5C\uFF1A "),H=h("\u5220\u9664");function I(e,t,o,c,m,i){const f=s("el-cascader"),p=s("el-input"),l=s("el-button"),d=s("el-row"),S=s("el-col"),b=s("router-link"),u=s("el-table-column"),v=s("el-table"),V=s("el-pagination"),D=U("loading");return C(),N(L,null,[a(d,{type:"flex",justify:"space-between"},{default:n(()=>[a(S,{span:18},{default:n(()=>[a(d,null,{default:n(()=>[k("div",A,[M,a(f,{class:"w-auto ml-5","show-all-levels":!1,modelValue:e.categorySelected,"onUpdate:modelValue":t[0]||(t[0]=r=>e.categorySelected=r),options:e.category,onChange:i.handleChange},null,8,["modelValue","options","onChange"])]),a(p,{class:"mr-10 w-auto",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9","suffix-icon":c.Search,modelValue:e.keywords,"onUpdate:modelValue":t[1]||(t[1]=r=>e.keywords=r),clearable:"",onClear:i.clearSearch},null,8,["suffix-icon","modelValue","onClear"]),a(l,{type:"primary",onClick:i.doSearch,round:""},{default:n(()=>[Q]),_:1},8,["onClick"])]),_:1})]),_:1}),a(b,{class:"c-fff add-btn",to:"/article/add"},{default:n(()=>[W]),_:1})]),_:1}),z((C(),F(v,{ref:"multipleTable",data:e.tableData,"tooltip-effect":"dark","row-key":"id",size:"small",onSelectionChange:i.handleSelectionChange},{default:n(()=>[a(u,{type:"selection"}),a(u,{prop:"id",label:"\u7F16\u53F7",width:"60",fixed:""}),a(u,{prop:"title",label:"\u6807\u9898"}),a(u,{prop:"name",label:"\u680F\u76EE",width:"80"}),a(u,{prop:"updatedAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"160"}),a(u,{prop:"status",label:"\u72B6\u6001",width:"60"},{default:n(r=>[h(R(r.row.status==0?"\u663E\u793A":"\u9690\u85CF"),1)]),_:1}),a(u,{fixed:"right",label:"\u64CD\u4F5C",width:"150"},{default:n(r=>[a(l,{icon:c.View,circle:"",onClick:_=>e.handleClick(r.row)},null,8,["icon","onClick"]),a(l,{icon:c.Edit,circle:"",onClick:_=>i.toEdit(r.row)},null,8,["icon","onClick"]),a(l,{icon:c.Delete,circle:"",onClick:_=>i.handleDel(r.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[D,e.loading]]),a(d,{type:"flex",class:"mt-20",justify:"space-between"},{default:n(()=>[k("div",X,[G,a(l,{onClick:i.delSome},{default:n(()=>[H]),_:1},8,["onClick"])]),a(V,{background:"",layout:"prev, pager, next",onCurrentChange:i.handleCurrentChange,"pager-size":10,total:e.count,currentPage:e.cur,"onUpdate:currentPage":t[2]||(t[2]=r=>e.cur=r),"hide-on-single-page":""},null,8,["onCurrentChange","total","currentPage"])]),_:1})],64)}const ye=j(Y,[["render",I]]);export{ye as default};
